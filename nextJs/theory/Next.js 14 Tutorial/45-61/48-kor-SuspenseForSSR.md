### SSR의 단점 - 전부 또는 전무 폭포 문제

1. **데이터 가져오기가 완료되어야 HTML 렌더링을 시작할 수 있음**

   - 서버가 HTML 렌더링을 시작하기 전에 모든 데이터를 가져와야 합니다.

2. **하이드레이션을 시작하기 전에 클라이언트 측에서 컴포넌트에 필요한 자바스크립트가 완전히 로드되어야 함**

   - 하이드레이션 프로세스가 시작되기 전에 클라이언트 측에서 컴포넌트에 필요한 모든 자바스크립트를 로드해야 합니다.

3. **모든 컴포넌트가 상호작용 가능해지기 전에 하이드레이션을 완료해야 함**
   - 모든 컴포넌트가 상호작용 가능해지기 전에 하이드레이션을 완료해야 합니다.

- 이러한 문제들은 '전부 또는 전무' 폭포 시나리오를 초래하며, 애플리케이션의 일부가 다른 부분보다 느린 경우 비효율성을 초래합니다.

### Suspense SSR 아키텍처

- `<Suspense>` 컴포넌트를 사용하여 두 가지 주요 SSR 기능을 활용할 수 있습니다:
  1. 서버 측 HTML 스트리밍
  2. 클라이언트 측 선택적 하이드레이션

### 서버 측 HTML 스트리밍

- 모든 데이터를 가져오지 않고도 콘텐츠를 표시할 수 있습니다.
- 특정 섹션이 초기 HTML을 지연시키는 경우, 이를 스트림에 나중에 원활하게 통합할 수 있습니다.
- 이것이 바로 Suspense가 서버 측 HTML 스트리밍을 지원하는 본질입니다.

### 다른 도전 과제

- 주요 섹션의 자바스크립트가 로드될 때까지 클라이언트 측 앱 하이드레이션을 시작할 수 없습니다.
- 만약 주요 섹션의 자바스크립트 번들이 크다면, 이로 인해 과정이 크게 지연될 수 있습니다.

### 코드 분할

- 코드 분할을 사용하면 특정 코드 세그먼트를 즉시 로드할 필요가 없는 것으로 표시할 수 있으며, 이는 번들러에 의해 별도의 `<script>` 태그로 분리됩니다.
- `React.lazy`를 사용한 코드 분할을 통해 주요 섹션의 코드를 기본 자바스크립트 번들에서 분리할 수 있습니다.
- 이제 클라이언트는 주요 섹션의 코드가 로드될 때까지 기다리지 않고 React 및 애플리케이션 전체 코드가 포함된 자바스크립트를 독립적으로 다운로드할 수 있습니다.

### 클라이언트 측 선택적 하이드레이션

- 주요 섹션을 `<Suspense>`로 감싸면, React는 나머지 페이지가 스트리밍될 뿐만 아니라 하이드레이션되지 않도록 방지하지 말라고 지시합니다.
- 이 기능은 '선택적 하이드레이션'이라고 하며, 나머지 HTML 및 자바스크립트 코드가 완전히 다운로드되기 전에 섹션이 이용 가능해지면 하이드레이션할 수 있도록 합니다.
- 선택적 하이드레이션 덕분에 무거운 자바스크립트가 나머지 페이지의 상호작용을 방해하지 않습니다.

### 클라이언트 측 선택적 하이드레이션 계속

- 선택적 하이드레이션은 "모든 것을 하이드레이션해야만 상호작용할 수 있다"는 문제에 대한 해결책을 제공합니다.
- React는 가능한 한 빨리 하이드레이션을 시작하여, 주요 콘텐츠가 하이드레이션될 때까지 기다리지 않고 헤더와 사이드 내비게이션과 같은 요소와 상호작용할 수 있게 합니다.
- 이 과정은 React에 의해 자동으로 관리됩니다.
- 여러 컴포넌트가 하이드레이션을 기다리는 시나리오에서, React는 사용자 상호작용에 기반하여 하이드레이션 우선 순위를 정합니다.

### Suspense SSR의 단점

1. **자바스크립트 코드가 비동기적으로 브라우저에 스트리밍되더라도, 결국 전체 코드가 사용자에게 다운로드되어야 함**

   - 애플리케이션이 더 많은 기능을 추가할수록 사용자가 다운로드해야 할 코드 양도 증가합니다. 이는 다음과 같은 중요한 질문을 제기합니다:
     - 사용자가 그렇게 많은 데이터를 다운로드해야 하는가?

2. **현재 접근 방식은 모든 React 컴포넌트가 클라이언트 측에서 하이드레이션되어야 한다고 요구함**

   - 이 과정은 자원을 비효율적으로 소모하고, 사용자 장치가 상호작용이 필요 없는 컴포넌트까지 처리하고 렌더링해야 하므로 로딩 시간과 상호작용 시간에 영향을 미칠 수 있습니다.
   - 이는 또 다른 질문을 제기합니다:
     - 상호작용이 필요 없는 컴포넌트까지 하이드레이션해야 하는가?

3. **서버의 강력한 처리 능력에도 불구하고, 자바스크립트 실행의 대부분은 여전히 사용자 장치에서 이루어짐**
   - 이는 성능 저하를 초래할 수 있으며, 특히 성능이 낮은 장치에서는 더욱 두드러집니다.
   - 이는 또 다른 중요한 질문을 제기합니다:
     - 이렇게 많은 작업이 사용자 장치에서 수행되어야 하는가?
